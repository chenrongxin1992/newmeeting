<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <!-- <link rel='stylesheet' href='/nm/stylesheets/style.css' /> -->
    <link rel='stylesheet' type='text/css' href='/nm/stylesheets/fullcalendar.css' />
    <link rel='stylesheet' type='text/css' href='/nm/stylesheets/layui.css' />
    <link rel='stylesheet' type='text/css' href='/nm/stylesheets/tooltips.css' />
    <link rel='stylesheet' type='text/css' href='/nm/stylesheets/bootstrap.min.css' />
    <link rel='stylesheet' type='text/css' href='/nm/stylesheets/jquery-ui.css' />
    <style type="text/css">
    	.room_name {
		    padding: 10px;
		    line-height: 50px;
		    text-align: center;
		}
		.footer{
			height: 20;
		    line-height: 20px;
		    padding: 0 15px;
		    margin-top: 15px;
		    text-align: center;
		}
		.qtip-event-detail {
			opacity: 1 !important;
			z-index: 9999999 !important;
		    width: 255px;
		    background-color: #fff;
		    border: 1px solid #e0e0e0;
		    border-radius: 2px;
		    border-top:3px solid #2878f0;
		    padding:2px;
		    box-shadow: 0 0 8px rgba(0,0,0,.2);
		}
		.qtip-event-detail .qtip-tip{
		    top: 6px !important;
		}
		.event-detail-wrap{
		    display: none;
		    opacity: 1 !important;
		    font-size: 14px;
		    line-height: 26px;
		    color: #666;
		    z-index: 9999999 !important;
		}
		.detail-info-list{
			opacity: 1 !important;
		    color: #999;
		}
		.qtip-focus{
			opacity: 1 !important;
			z-index: 9999999 !important;
		}
		.qtip{
			opacity: 1 !important;
			z-index: 9999999 !important;
		}
    </style>
  </head>
  <body>
  	<div class="layui-container">  
  		<div class="layui-row">
    		<div class="layui-col-md12 room_name">
      			<%= room_name %> 使用情况
	   		</div>
  		</div>
  		<div class="layui-row">
  			<div class="layui-col-md12">
  				<div id='calendar'></div>
  			</div>
  		</div>
  		<div class="layui-row">
  			<div class="layui-col-md12">
  				<p class="footer"><span>csse &copy; 2019</span></p>
  				<hr/>
  			</div>
  		</div>
  	</div>

  	<div class="event-detail-wrap" id="event-detail">
	    <div class="detail-info-list">
	        <div class="js_event_detail_title"></div>
	        <div class="js_event_detail_time"></div>
	        <div class="js_event_detail_fuzeren"></div>
	        <div class="js_event_detail_phone"></div>
	        <div class="js_event_detail_applytime"></div>
	        <div class="js_event_detail_status"></div>
	    </div>
	</div>
    
  </body>
  <script src="/nm/javascripts/moment.min.js"></script>
  <script src="/nm/javascripts/jquery3.2.min.js"></script>
  <script src="/nm/javascripts/fullcalendar.min.js"></script>
  <script src="/nm/javascripts/zh-cn.js"></script>
  <script src="/nm/javascripts/layui.all.js"></script>
  <script src="/nm/javascripts/jquery.pure.tooltips.js"></script>

<script type="text/javascript">
	$(document).ready(function() {
		let layer = layui.layer,mytips
    	// 页面加载完毕，初始化Canlendar
	    $('#calendar').fullCalendar({
	    	customButtons: {
		        938: {
		            text: '938',
		            click: function() {
		                window.location.href="/nm/nmlist?r=938" 
		            }
		        },
		        bgt: {
		            text: '一楼报告厅',
		            click: function() {
		                window.location.href="/nm/nmlist?r=bgt" 
		            }
		        },
		        623: {
		            text: '623',
		            click: function() {
		                window.location.href="/nm/nmlist?r=623" 
		            }
		        },
		        624: {
		            text: '624',
		            click: function() {
		                window.location.href="/nm/nmlist?r=624" 
		            }
		        },
		        413: {
		            text: '413',
		            click: function() {
		                window.location.href="/nm/nmlist?r=413" 
		            }
		        },
		        1019: {
		            text: '1019',
		            click: function() {
		                window.location.href="/nm/nmlist?r=1019" 
		            }
		        },
		        117: {
		            text: '117',
		            click: function() {
		                window.location.href="/nm/nmlist?r=117" 
		            }
		        },
		        hysinfo:{
		        	text:'会议室简况',
		        	click:function(){
		        		layer.open({
						  type: 2,
						  title: '会议室简况',
						  shadeClose: true,
						  shade: 0.8,
						  area: ['750px', '50%'],
						  content: 'hysinfo', //iframe的url
						  end:function(){
						  	
						  }
						}); 
		        	}
		        }
		    },
	    	header: {
	            left: 'prev,next today,938,bgt,623,624,413,1019,117,hysinfo',
	            center: 'title',
	            right: 'month,agendaWeek'
	        },
	        themeSystem: 'bootstrap3',  // 使用bootstrap3风格
	        locale:'zh-cn',
	        titleFormat:'YYYY - MM',
	        timeFormat:'H(:mm)',
	        weekNumberTitle:'周',
	        weekNumbers:true,
	        monthNames: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
		    monthNamesShort: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
		    dayNames: ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"],
		    dayNamesShort: ["周日", "周一", "周二", "周三", "周四", "周五", "周六"],
			buttonText: {
				today: '今天',
				month: '月',
				week: '周',
				day: '天'
			},
			allDaySlot:true,//显示全天
			allDayText:'全天',
			slotLabelFormat:'HH:mm',//显示y轴时间格式
			//每天几点开始显示
			minTime:8,
			minTime:'8:30',
			maxTime:22,
			maxTime:'21:30',
			weekends:true,
	        defaultView: 'agendaWeek',
	        weekMode:'fixed',
	        height: 700,
		    handleWindowResize:true,//是否随浏览器窗口大小变化而自动变化。
		    firstDay: new Date().getDay(),//1,
	        businessHours: [ // specify an array instead
	            {
	                dow: [ 1, 2, 3, 4, 5 ], // Monday, Tuesday, Wednesday
	                start: '08:30', // 8am
	                end: '21:30' // 6pm
	            }
	        ],
	        //events: 'eventjson?r='+getQueryVariable('r'), //事件数据源
	        editable: true,
	        eventDurationEditable:true,
	        eventStartEditable:false,
	        selectHelper:true,
	        selectable: false,//不能被拖动
	        eventLimit: 2,       //数据条数太多时，限制各自里显示的数据条数（多余的以“+2more”格式显示），默认false不限制,支持输入数字设定固定的显示条数
	        eventLimitText  : "更多",       //当一块区域内容太多以"+2 more"格式显示时，这个more的名称自定义（应该与eventLimit: true一并用）

	   		eventResize : function( event, dayDelta, revertFunc ) {
			    console.log(' --- start --- eventResize',dayDelta);
			    console.log('eventResize被执行，Event的title属性值为：', event.title,'当前用户','<%=user.cn%>','事件申请人',event.applyname,'审批情况',event.isok);
			    if(dayDelta._days != 0 && event.isok == 0 && event.applyname == '<%=user.cn%>' && moment(event.date).diff(moment(),'day')>=0){
			    	if('<%=user.cn%>'==event.applyname && event.isok!=1 && moment(event.date).diff(moment(),'day')>=0){
			    		console.log('改变了',dayDelta._days,'天',event.end._i)
			    		$.ajax({
						  	type: "POST",
							url: "/nm/changeallday",
							data: {'_id':event.myid,'end':(moment(event.end._i)).add(dayDelta._days, 'd').format('YYYY-MM-DD'),'alldayend':(moment(event.alldayend)).add(dayDelta._days, 'd').format('YYYY-MM-DD')},
							success: function (result) {
								if(result.code==0){
									console.log('changeallday success')
									//return false
									//$('#calendar').fullCalendar('removeEvents');
			           				//getAgentEvent(1)
								}else{
									layer.msg(result.msg)
								}
							}
						})
			        		console.log('eventResize被执行，Event的start和end时间改变了：', dayDelta._days+'天！');
			    	}else{
			    		console.log('不符合条件，回退')
			        	revertFunc()
			    	}	
			    }else if(dayDelta._milliseconds != 0){
			    	let datestr = event.date + ' ' + event.endTime
			    	console.log(datestr)
			    	//return false
			        console.log('eventResize被执行，Event的start和end时间改变了：', dayDelta._milliseconds/1000+'秒！',moment(datestr).format('HH:mm'),event.end,datestr);//return false
			        console.log('--------------------------------------')
			        console.log('如果尚未审批，且记录是申请人自己，可以拖动，否则恢复原状','<%=user.cn%>',event.applyname,event.isok)
			        if('<%=user.cn%>'==event.applyname && event.isok!=1 && moment(event.date).diff(moment(),'day')>=0){
			        	 $.ajax({
						  	type: "POST",
							url: "/nm/changeallday",
							data: {'_id':event.myid,'end':moment(datestr).add(dayDelta._milliseconds/1000, 'seconds').format('HH:mm')},
							success: function (result) {
								if(result.code==0){
									console.log('changeallday  success')
									//return false
									// $('#calendar').fullCalendar('removeEvents');
			      //      				getAgentEvent(1)
								}else{
									layer.msg(result.msg)
								}
							}
						})
			        }else{
			        	console.log('不符合条件，回退')
			        	revertFunc()
			        }
			    }else{
			        console.log('eventResize被执行，Event的start和end时间没有改变！');
			    }
			    //revertFunc();
			    console.log('--- end --- eventResize');
			    // ...
			},
	        dayClick: function(date){//date为点击日期
		        console.log('dayClick',date.format())
		        let click_date = date.format()
		        if(click_date.length >10){
		        	console.log('在周视图中点击')
		        	//弹框输入信息
		        	let myjson = {}
		        	let tempdate = click_date.substring(0,10)
		        	if(moment(tempdate).diff(moment(),'day')<0){
		        		console.log('时间已过，不响应')
		        		return false
		        	}
		        	myjson.click_date = click_date.substring(0,10)
		        	myjson.room_name = getQueryVariable('r')
		        	json = myjson//json全局变量,传值到子页面
		        	//let layer = layui.layer
		        	layer.open({
					  type: 2,
					  title: '信息登记',
					  shadeClose: true,
					  shade: 0.8,
					  area: ['750px', '50%'],
					  content: 'applyform', //iframe的url
					  end:function(){
					  	$('#calendar').fullCalendar('removeEvents');
					  	 getAgentEvent(1)
					  }
					}); 
		        }else{
		        	console.log('在月视图中点击，直接定全天日程',date.format())
		        	let click_date = date.format()
		        	let myjson = {}
		        	let tempdate = click_date.substring(0,10)
		        	if(moment(tempdate).diff(moment(),'day')<0){
		        		console.log('时间已过，不响应')
		        		return false
		        	}
		        	myjson.click_date = click_date
		        	myjson.room_name = getQueryVariable('r')
		        	json = myjson//json全局变量,传值到子页面
		        	layer.open({
					  type: 2,
					  title: '信息登记-全天',
					  shadeClose: true,
					  shade: 0.8,
					  area: ['750px', '50%'],
					  content: 'applyform_allday', //iframe的url
					  end:function(){
					  	$('#calendar').fullCalendar('removeEvents');
					  	 getAgentEvent(0)
					  }
					}); 
		        }
		    },
		    eventClick:function(event){
		    	console.log('点击事件，如果过期不响应')
		    	if(moment(event.date).diff(moment(),'day')<0){
		    		console.log('已过期')
		    		return false
		    	}
		    	console.log('点击事件，若是管理员则弹出审批框---->event',event)
		    	//弹框输入信息
		    	let admin = '<%=user.admin%>'
		    	console.log('check admin-->',admin)
		    	json = event//json全局变量,传值到子页面
		    	//let layer = layui.layer
		    	if(admin == 0){
		    		console.log('非管理员，不响应')
		    		if(event.applyname == '<%=user.cn%>'&&event.isok==0){
		    			console.log('申请人再次点击---修改')
		    			//myjson = event
		    			event.modify = 1
		    			event.room_name = getQueryVariable('r')
		    			json = event
			        	//json = JSON.stringify(myjson)//json全局变量,传值到子页面
			        	//let layer = layui.layer
			        	if(event.allDay){
			        		console.log('全天时间，不要弹框修改，直接拉动修改')
			        		layer.msg('可以拉动右方进行日期延长')
			        		return false
			        	}else{
			        		console.log('非全天时间，不要弹框修改，直接拉动修改',$('#calendar').fullCalendar('getView'))
			        		let clickview = $('#calendar').fullCalendar('getView')
			        		if(clickview.name == 'month'){
			        			console.log('月视图点击事件，不响应')
			        			return false
			        		}else{
			        			layer.msg('可以拉动下方进行时间修改')
			        		}
			        		
			    //     		layer.open({
							//   type: 2,
							//   title: '信息修改',
							//   shadeClose: true,
							//   shade: 0.8,
							//   area: ['750px', '50%'],
							//   content: 'applyform', //iframe的url
							//   end:function(){
							//   	$('#calendar').fullCalendar('removeEvents');
							//   	 getAgentEvent(1)
							//   }
							// }); 
			        	}
		    		}
		    	}else if(admin==1){
		    		console.log('管理员1...')		        	
		        	if(event.allDay == true) {
		        		console.log('全天时间审批--------------')
		        		layer.open({
						  type: 2,
						  title: '审批申请-全天',
						  shadeClose: true,
						  shade: 0.8,
						  area: ['750px', '50%'],
						  content: 'spsq_allday', //审批申请
						  end:function(){
						  	$('#calendar').fullCalendar('removeEvents');
						  	 getAgentEvent(1)
						  }
						});
		        	}else{
		        		console.log('非全天时间审批--------------')
		        		layer.open({
						  type: 2,
						  title: '审批申请',
						  shadeClose: true,
						  shade: 0.8,
						  area: ['750px', '50%'],
						  content: 'spsq', //审批申请
						  end:function(){
						  	$('#calendar').fullCalendar('removeEvents');
						  	 getAgentEvent(1)
						  }
						});
		        	}
		    	}else if((admin==2&&event.room_name=='624')||(admin==2&&event.room_name=='623')){
		    		console.log('zeng...')
		    		if(event.allDay == true) {
		    			console.log('全天时间审批--------------')
		        		layer.open({
						  type: 2,
						  title: '审批申请-全天',
						  shadeClose: true,
						  shade: 0.8,
						  area: ['750px', '50%'],
						  content: 'spsq_allday', //审批申请
						  end:function(){
						  	$('#calendar').fullCalendar('removeEvents');
						  	 getAgentEvent(1)
						  }
						});
		    		}else{
		    			layer.open({
						  type: 2,
						  title: '审批申请',
						  shadeClose: true,
						  shade: 0.8,
						  area: ['750px', '50%'],
						  content: 'spsq', //审批申请
						  end:function(){
						  	$('#calendar').fullCalendar('removeEvents');
						  	 getAgentEvent(1)
						  }
						}); 
		    		}
		    		
		    	}else if((admin==3&&event.room_name=='413')){
		    		console.log('liu...')
		    		if(event.allDay == true) {
		    			console.log('全天时间审批--------------')
		        		layer.open({
						  type: 2,
						  title: '审批申请-全天',
						  shadeClose: true,
						  shade: 0.8,
						  area: ['750px', '50%'],
						  content: 'spsq_allday', //审批申请
						  end:function(){
						  	$('#calendar').fullCalendar('removeEvents');
						  	 getAgentEvent(1)
						  }
						});
		    		}else{
		    			layer.open({
						  type: 2,
						  title: '审批申请',
						  shadeClose: true,
						  shade: 0.8,
						  area: ['750px', '50%'],
						  content: 'spsq', //审批申请
						  end:function(){
						  	$('#calendar').fullCalendar('removeEvents');
						  	 getAgentEvent(1)
						  }
						}); 
		    		}
		    	}else if((admin==4&&event.room_name=='1019')){
		    		console.log('he...')
		    		if(event.allDay == true) {
		    			console.log('全天时间审批--------------')
		        		layer.open({
						  type: 2,
						  title: '审批申请-全天',
						  shadeClose: true,
						  shade: 0.8,
						  area: ['750px', '50%'],
						  content: 'spsq_allday', //审批申请
						  end:function(){
						  	$('#calendar').fullCalendar('removeEvents');
						  	 getAgentEvent(1)
						  }
						});
		    		}else{
		    			layer.open({
						  type: 2,
						  title: '审批申请',
						  shadeClose: true,
						  shade: 0.8,
						  area: ['750px', '50%'],
						  content: 'spsq', //审批申请
						  end:function(){
						  	$('#calendar').fullCalendar('removeEvents');
						  	 getAgentEvent(1)
						  }
						}); 
		    		}
		    	}else if((admin==5&&event.room_name=='117')){
		    		console.log('ma...')
		    		if(event.allDay == true) {
		    			console.log('全天时间审批--------------')
		        		layer.open({
						  type: 2,
						  title: '审批申请-全天',
						  shadeClose: true,
						  shade: 0.8,
						  area: ['750px', '50%'],
						  content: 'spsq_allday', //审批申请
						  end:function(){
						  	$('#calendar').fullCalendar('removeEvents');
						  	 getAgentEvent(1)
						  }
						});
		    		}else{
		    			layer.open({
						  type: 2,
						  title: '审批申请',
						  shadeClose: true,
						  shade: 0.8,
						  area: ['750px', '50%'],
						  content: 'spsq', //审批申请
						  end:function(){
						  	$('#calendar').fullCalendar('removeEvents');
						  	 getAgentEvent(1)
						  }
						}); 
		    		}
		    	}
		    },
			eventRender:function(event,info){//日程事件渲染时触发
				console.log('日程渲染触发....',event,$(info))
				// let viewinfo = event.title + '开始时间：' + event.startTime + '<br/>结束时间：' + event.endTime
				// $(info).html(viewinfo);
				let status = '未通过'
				if(event.isok == 1){
					status = '通过'
				}
				let delbtn = ''
				if((event.applyname == '<%=user.cn%>'&&event.isok==0&&moment(event.date).diff(moment(),'day')>0)||('<%=user.admin%>'==1) || ('<%=user.admin%>'==3&&event.room_name=='413') || ('<%=user.admin%>'==4&&event.room_name=='1019') || ('<%=user.admin%>'==5&&event.room_name=='117') || ('<%=user.admin%>'==2&&event.room_name=='624') || ('<%=user.admin%>'==2&&event.room_name=='623')){
					console.log('申请人或管理员，显示删除按钮')
					delbtn = '<button class="layui-btn layui-btn-warm layui-btn-xs delbtn" _id="'+event.myid+'">删除</button>'
				}
				//如果是申请人本人，添加删除按钮
				if(event.allDay){
					$(info).pt({
					    position: 'r', // 默认属性值
					    align: 't',	   // 默认属性值
					    content: '用途：' + event.mytitle + '<br/>时间：' + event.alldaystart + "-" + event.alldayend + '<br/>负责人：' + event.fuzeren + '<br/>电话：' + event.phone + '<br/>申请时间：' + event.applytime + '<br/>状态：<span style="color:red;">' + status + '</span><br/>' + delbtn,
					    height:'auto',
					    width:'250'
					})
				}else{
					$(info).pt({
					    position: 'r', // 默认属性值
					    align: 't',	   // 默认属性值
					    content: '用途：' + event.mytitle + '<br/>时间：' + event.startTime + "-" + event.endTime + '<br/>负责人：' + event.fuzeren + '<br/>电话：' + event.phone + '<br/>申请时间：' + event.applytime + '<br/>状态：<span style="color:red;">' + status + '</span><br/>' + delbtn,
					    height:'auto',
					    width:'250'
					})
				}
			},
			viewRender : function(view,element){//在视图被渲染时触发（切换视图也触发） 参数view为视图对象，参数element为Jquery的视图Dom
                //清除原本所有的日历记录
                console.log('切换视图.....')
                console.log('view---',view)
                if(view.name == 'agendaWeek'){
                	console.log('周视图，显示周的预定信息')
                	$('#calendar').fullCalendar('removeEvents');
		          getAgentEvent(1)
                }else{
                	console.log('月视图，显示月的预定信息')
		            $('#calendar').fullCalendar('removeEvents');
		           getAgentEvent(0)
                }//else
                return false      
            },
	    });
			//监听删除
				$(document).on('click','.delbtn',function(){
					let _id = $(this).attr('_id')
					console.log('del _id',_id)
					layer.confirm('删除该条记录？', {
					  //btn: ['重要','奇葩'] //按钮
					}, function(){
					  $.ajax({
					  	type: "POST",
						url: "/nm/delnm",
						data: {'_id':_id},
						success: function (result) {
							if(result.code==0){
								layer.msg('已删除')
								$('#calendar').fullCalendar('removeEvents');
		           				getAgentEvent(1)
							}else{
								layer.msg(result.msg)
							}
						}
					  })
					});
					return false
				})
	    //清除原本所有的日历记录
		//$('#calendar').fullCalendar('removeEvents');
		//getAgentEvent(1)
	});

function getAgentEvent(isWeek){
	let firstDay_of_month = moment().startOf('month').format('YYYY-MM-DD')
		console.log('firstDay_of_month',firstDay_of_month)
	let endDay_of_month = moment().endOf('month').format('YYYY-MM-DD')
		console.log('endDay_of_month',endDay_of_month)
	if(isWeek){
		firstDay_of_month = null
		endDay_of_month = null
		let curview = $('#calendar').fullCalendar('getView')
		firstDay_of_week = moment(curview.start._i).format('YYYY-MM-DD')
		endDay_of_week = moment(curview.end._i).format('YYYY-MM-DD')
	}
	//获取会议室参数
	let room_name = getQueryVariable("r")
	console.log('room_name-->',room_name)
	let btnarr = $('button')
	$.each(btnarr,function(key,val){
		console.log(val)
		if($(this).text() == room_name){
			console.log('find...')
			$(this).addClass('fc-state-disabled')
			return false
		}
		if($(this).text() == '一楼报告厅' && room_name == 'bgt'){
			console.log('find...')
			$(this).addClass('fc-state-disabled')
			return false
		}
		// if(room_name == 001){
		// 	console.log('一楼报告厅')
		// 	$(this).addClass('fc-state-disabled')
		// }
	})
	
	$.ajax({
		type: "POST",
		url: "/nm/getapplyinfo",
		data: {'firstDay_of_month':firstDay_of_month,'endDay_of_month':endDay_of_month,'room_name':room_name,'firstDay_of_week':firstDay_of_week,'endDay_of_week':endDay_of_week,'room_name':getQueryVariable('r')},
		success: function (result) {
			if(result.code==0){
				if (result.data.length>0) {
					$.each(result.data, function (index, info) {
						console.log('info--->',info)
						let eventObj = new Object()
						let status = '未通过'
						if(info.isok == 1){
							status = '通过'
						}
						//构造每一个日历记录
						console.log(moment(info.date).diff(moment(),'day'))
						if(moment(info.date).diff(moment(),'day')<0){
							console.log('记录已过期')
							eventObj.color = 'gray'
							//return false
						}else if(moment(info.date).diff(moment(),'day')>=0 && info.isok == 1){
							eventObj.color = 'green'
						}
						else{
							eventObj.color = 'orange'
						}
						eventObj.title = info.title + '\r\n'+ status	
						// eventObj.title = '用途：' + info.title + '<br/> 负责老师：' + info.fuzeren + '<br/>' + '状态：<span style="color:red;">' + status + '</span><br/>'	
						eventObj.mytitle = info.title						
						//eventObj.title = info.title;
						eventObj.allDay = false//will make the time show
						if(info.allDay==true){
							eventObj.start = info.date;
							eventObj.end = info.end
							eventObj.allDay=true
						}else{
							eventObj.start = new Date(info.date + ' ' + info.start);
							eventObj.end = new Date(info.date + ' ' + info.end) ;
							
						}
						eventObj.startTime = info.start
						eventObj.endTime = info.end
						eventObj.myid = info._id
						eventObj.mytitle = info.title
						eventObj.num = info.num
						eventObj.phone = info.phone
						eventObj.fuzeren = info.fuzeren
						eventObj.isok = info.isok
						eventObj.room_name = info.room_name
						eventObj.date = info.date
						eventObj.applytime = info.applytime
						eventObj.applyname = info.applyname
						eventObj.alldaystart = info.alldaystart
						eventObj.alldayend = info.alldayend
						let arr = [];
						//className是可以存放一些信息包括数组，方便在日历事件的时候使用			 
						//eventObj.className = arr;
						//eventObj.allDay = false;
						console.log('renderEvent--->',eventObj)
						//刷新日历里面的记录
						$('#calendar').fullCalendar('renderEvent', eventObj, true);
					})
				} 
				else {
					console.log('no data',result.data)
				}
				}else{
					 console.log(result)
			}
		}
	})//ajax  
	return false
}
function getQueryVariable(variable)
{
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}
</script>
</html>
